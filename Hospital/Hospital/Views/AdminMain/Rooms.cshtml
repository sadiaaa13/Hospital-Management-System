@model IEnumerable<Demo.Models.Room>
@{
    ViewBag.Title = "Room Management";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<div class="container mt-5">
    <h2 class="text-center mb-4">Assign Room to Patient</h2>

    <!-- Room Assignment Form -->
    <form method="post" action="@Url.Action("AssignRoom", "AdminMain")" class="mb-4">
        <div class="row">
            <!-- Patient Name Input -->
            <div class="col-md-3">
                <div class="form-group">
                    <label for="patientName">Enter Patient Name:</label>
                    <input type="text" name="patientName" id="patientName" class="form-control" required />
                </div>
            </div>

            <!-- Room Number Input -->
            <div class="col-md-3">
                <div class="form-group">
                    <label for="roomNumber">Enter Room Number:</label>
                    <input type="text" name="roomNumber" id="roomNumber" class="form-control" required />
                </div>
            </div>

            <!-- Price Input -->
            <div class="col-md-3">
                <div class="form-group">
                    <label for="price">Enter Price:</label>
                    <input type="number" name="price" id="price" class="form-control" required />
                </div>
            </div>

            <!-- Capacity Input -->
            <div class="col-md-3">
                <div class="form-group">
                    <label for="capacity">Enter Capacity:</label>
                    <input type="number" name="capacity" id="capacity" class="form-control" required />
                </div>
            </div>

            <div class="col-md-12 d-flex justify-content-end mt-3">
                <button type="submit" class="btn btn-primary">Assign Room</button>
            </div>
        </div>
    </form>

    <!-- Assigned Rooms List -->
    <h3 class="text-center mb-4">Assigned Rooms</h3>

    @if (ViewBag.AssignedRooms != null && ViewBag.AssignedRooms.Count > 0)
    {
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Room Number</th>
                    <th>Patient Name</th>
                    <th>Price</th>
                    <th>Capacity</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var room in ViewBag.AssignedRooms)
                {
                    <tr>
                        <td>@room.room_number</td>
                        <td>@room.PatientName</td> <!-- Updated: Show PatientName directly -->
                        <td>@room.room_price</td>
                        <td>@room.capacity</td>
                        <td>
                            <!-- Edit Button -->
                            <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#editModal@room.room_id">Edit</button>

                            <!-- Delete Button -->
                            @using (Html.BeginForm("RemoveRoomAssignment", "AdminMain", FormMethod.Post))
                            {
                                @Html.AntiForgeryToken()
                                @Html.Hidden("roomId", (int)room.room_id)

                                <button type="submit" class="btn btn-danger">Delete</button>
                            }
                        </td>
                    </tr>

                    <!-- Modal for Editing Room -->
                    <div class="modal fade" id="editModal@room.room_id" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editModalLabel">Edit Room Assignment</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    <form method="post" action="@Url.Action("EditRoomAssignment", "AdminMain")">
                                        <input type="hidden" name="roomId" value="@room.room_id" />

                                        <div class="form-group">
                                            <label for="editPatientName">Enter New Patient Name:</label>
                                            <input type="text" name="editPatientName" value="@room.PatientName" class="form-control" />
                                        </div>

                                        <div class="form-group">
                                            <label for="editRoomNumber">Enter Room Number:</label>
                                            <input type="text" name="editRoomNumber" value="@room.room_number" class="form-control" />
                                        </div>

                                        <div class="form-group">
                                            <label for="editPrice">Enter Price:</label>
                                            <input type="number" name="editPrice" value="@room.room_price" class="form-control" />
                                        </div>

                                        <div class="form-group">
                                            <label for="editCapacity">Enter Capacity:</label>
                                            <input type="number" name="editCapacity" value="@room.capacity" class="form-control" />
                                        </div>

                                        <button type="submit" class="btn btn-primary mt-3">Save Changes</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </tbody>
        </table>
    }
    else
    {
        <p class="text-center">No room assignments found.</p>
    }
</div>
